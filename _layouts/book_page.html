---
layout: default
---

<style>
    /* 1. РАЗДВИГАЕМ И ЦЕНТРИРУЕМ ВНЕШНИЙ КОНТЕЙНЕР */
    .container.main-content, .container, .content {
        max-width: 1300px !important;
        width: 100% !important;
        margin: 0 auto !important;
        padding: 0 !important;
    }

    /* 2. ГЛАВНАЯ ОБЕРТКА: СТРОГО В ОДИН РЯД */
    .book-page-wrapper {
        display: flex !important;
        flex-direction: row !important; /* Запрещаем сваливаться вниз */
        flex-wrap: nowrap !important; 
        justify-content: center !important;
        gap: 40px !important;
        width: 100% !important;
        margin: 40px auto !important;
    }

    /* 3. ЛЕВАЯ КОЛОНКА (70% МИНУС ОТСТУП) */
    .book-main-content {
        width: calc(75% - 40px) !important;
        flex-shrink: 1 !important;
        min-width: 0;
    }

    /* 4. ПРАВАЯ КОЛОНКА (ФИКСИРОВАННАЯ) */
    .book-sidebar {
        width: 320px !important;
        flex-shrink: 0 !important; /* Запрещаем сжиматься */
        border-left: 1px solid #eee;
        padding-left: 20px;
    }

    /* 5. КАРТИНКА И ОБТЕКАНИЕ */
    .book-cover-img {
        float: left !important;
        width: 280px !important;
        height: auto !important;
        margin: 0 25px 15px 0 !important;
        border-radius: 8px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    /* 6. СЕТКА РЕЦЕПТОВ: СТРОГО 2 В РЯД */
    .mini-recipe-grid { 
        display: grid !important; 
        grid-template-columns: 1fr 1fr !important; 
        gap: 12px !important; 
    }

    .mini-recipe-card { background: #fff; border-radius: 4px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.08); }
    .mini-image-wrapper { width: 100%; aspect-ratio: 1/1; position: relative; }
    .mini-image-wrapper img { position: absolute; top:0; left:0; width:100%; height:100%; object-fit: cover; }
    .mini-title-box { padding: 6px 2px; text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center; }
    .mini-title { font-size: 0.7rem !important; margin: 0; color: #333; line-height: 1.2; font-weight: 600; }

    .hidden { display: none; }
</style>

<div class="book-page-wrapper">
  
  <div class="book-main-content">
    <img src="{{ page.book_cover }}" alt="{{ page.book_title }}" class="book-cover-img">

    <h1 style="margin: 0 0 5px 0; font-size: 2rem; color: #333; line-height: 1.2;">{{ page.book_title }}</h1>
    <p style="color: #888; font-style: italic; margin-bottom: 20px;">{{ page.book_author }}</p>
      
    <div class="book-description" style="line-height: 1.6; color: #444; font-size: 1.05rem; text-align: justify;">
      {{ content }}
    </div>

    <div style="margin-top: 30px; clear: both;">
      <a href="{{ page.book_link }}" target="_blank" 
         style="display: inline-block; background: #fa8569; color: #fff; text-decoration: none; padding: 12px 30px; border-radius: 5px; font-weight: bold; text-transform: uppercase; font-size: 0.85rem;">
        Открыть книгу
      </a>
    </div>
  </div>

  <div class="book-sidebar">
    <div style="border-bottom: 2px solid #fa8569; padding-bottom: 10px; margin-bottom: 15px;">
      <h3 style="margin: 0; font-size: 1rem; color: #333;">Все рецепты книги (<span id="recipes-count">0</span>)</h3>
      <div id="filter-container" style="margin-top: 10px; position: relative;">
        <button id="filter-toggle" style="width: 100%; font-size: 0.75rem; padding: 5px; cursor: pointer;">Фильтр категорий <span id="sel-count"></span></button>
        <div id="checkbox-list-container" class="hidden" style="position: absolute; background: white; border: 1px solid #ccc; width: 100%; z-index: 10; padding: 10px; font-size: 0.75rem;">
            <div><input type="checkbox" id="all-cat" value="all"> <label for="all-cat">Все</label></div>
        </div>
      </div>
    </div>
    <div id="mini-recipes-grid" class="mini-recipe-grid"></div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async function () {
    const bookSlug = "{{ page.book_slug }}"; 
    const grid = document.getElementById("mini-recipes-grid");
    const checkboxContainer = document.getElementById("checkbox-list-container");

    try {
        const response = await fetch(`/api/recipes/${bookSlug}.json`);
        const allRecipes = await response.json();
        document.getElementById("recipes-count").textContent = allRecipes.length;

        const render = (list) => {
            grid.innerHTML = list.map(r => `
                <div class="mini-recipe-card">
                    <a href="${r.url}" style="text-decoration:none; color:inherit;">
                        <div class="mini-image-wrapper"><img src="${r.featured_image || r.book_cover}"></div>
                        <div class="mini-title-box"><h2 class="mini-title">${r.title}</h2></div>
                    </a>
                </div>`).join('');
        };

        const categories = [...new Set(allRecipes.flatMap(r => r.categories || []))].sort();
        categories.forEach(cat => {
            const div = document.createElement("div");
            div.innerHTML = `<input type="checkbox" value="${cat}"> <label style="font-size:0.75rem;">${cat}</label>`;
            checkboxContainer.appendChild(div);
        });

        render(allRecipes);
        document.getElementById("filter-toggle").onclick = () => checkboxContainer.classList.toggle("hidden");

        checkboxContainer.onchange = () => {
            const boxes = Array.from(checkboxContainer.querySelectorAll('input:checked')).map(b => b.value);
            const filtered = (boxes.length === 0 || boxes.includes('all')) ? allRecipes : allRecipes.filter(r => (r.categories || []).some(c => boxes.includes(c)));
            render(filtered);
            document.getElementById("sel-count").textContent = boxes.length > 0 ? `(${boxes.length})` : '';
        };
    } catch (e) { console.error(e); }
});
</script>
