---
layout: default
---

<style>
    /* 1. УБИРАЕМ ПУСТОТУ СПРАВА: Расширяем главный контейнер на 90% экрана */
    .container.main-content, .container, .content, .site-content {
        max-width: 90vw !important; /* Пробиваем стену */
        width: 90vw !important;
        margin: 0 auto !important; /* Центрируем расширенный блок */
        padding: 0 !important;
    }

    /* 2. ГЛАВНАЯ ОБЕРТКА */
    .book-page-wrapper {
        display: flex !important;
        flex-direction: row !important;
        justify-content: space-between !important;
        gap: 50px !important;
        width: 100% !important;
        margin: 40px 0 !important;
    }

    /* 3. ЛЕВАЯ КОЛОНКА — ТЕПЕРЬ 70% ШИРИНЫ ЭКРАНА */
    .book-main-content {
        width: 70% !important;
        flex-shrink: 1 !important;
        min-width: 0;
    }

    /* 4. ПРАВАЯ КОЛОНКА (САЙДБАР) — ОСТАЕТСЯ ФИКСИРОВАННОЙ */
    .book-sidebar {
        width: 350px !important;
        flex-shrink: 0 !important;
        border-left: 1px solid #eee;
        padding-left: 30px;
    }

    /* 5. КАРТИНКА И ОБТЕКАНИЕ (Тут всё ок, фиксируем) */
    .book-cover-img {
        float: left !important;
        width: 320px !important;
        margin: 0 35px 20px 0 !important;
        border-radius: 8px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    /* 6. ИСПРАВЛЕНИЕ ФИЛЬТРА (Галочки в ряд с текстом) */
    .checkbox-item {
        display: flex !important;
        align-items: center !important;
        gap: 12px !important;
        margin-bottom: 10px !important;
        cursor: pointer;
    }

    .checkbox-item input[type="checkbox"] {
        margin: 0 !important;
        width: 18px !important;
        height: 18px !important;
        flex-shrink: 0 !important;
        display: inline-block !important;
    }

    .checkbox-item label {
        display: inline-block !important;
        margin: 0 !important;
        font-size: 0.95rem !important;
        cursor: pointer;
        line-height: 1.2 !important;
    }

    /* 7. СЕТКА РЕЦЕПТОВ (СТРОГО 2 В РЯД) */
    .mini-recipe-grid { 
        display: grid !important; 
        grid-template-columns: 1fr 1fr !important; 
        gap: 15px !important; 
    }

    .mini-recipe-card { background: #fff; border-radius: 4px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.08); }
    .mini-image-wrapper { width: 100%; aspect-ratio: 1/1; position: relative; }
    .mini-image-wrapper img { position: absolute; top:0; left:0; width:100%; height:100%; object-fit: cover; }
    .mini-title-box { padding: 8px 4px; text-align: center; min-height: 45px; display: flex; align-items: center; justify-content: center; }
    .mini-title { font-size: 0.8rem !important; margin: 0; color: #333; line-height: 1.2; font-weight: 600; }

    .hidden { display: none; }
</style>

<div class="book-page-wrapper">
  
  <div class="book-main-content">
    <img src="{{ page.book_cover }}" alt="{{ page.book_title }}" class="book-cover-img">

    <h1 style="margin: 0 0 10px 0; font-size: 2.8rem; color: #333; line-height: 1.1;">{{ page.book_title }}</h1>
    <p style="color: #888; font-style: italic; margin-bottom: 25px; font-size: 1.3rem;">{{ page.book_author }}</p>
      
    <div class="book-description" style="line-height: 1.8; color: #444; font-size: 1.15rem; text-align: justify;">
      {{ content }}
    </div>

    <div style="margin-top: 40px; clear: both;">
      <a href="{{ page.book_link }}" target="_blank" 
         style="display: inline-block; background: #fa8569; color: #fff; text-decoration: none; padding: 18px 45px; border-radius: 5px; font-weight: bold; text-transform: uppercase; font-size: 1rem;">
        Открыть книгу
      </a>
    </div>
  </div>

  <div class="book-sidebar">
    <div style="border-bottom: 2px solid #fa8569; padding-bottom: 12px; margin-bottom: 25px;">
      <h3 style="margin: 0; font-size: 1.2rem; color: #333; font-weight: bold;">Все рецепты из книги (<span id="recipes-count">0</span>)</h3>
      <div id="filter-container" style="margin-top: 15px; position: relative;">
        <button id="filter-toggle" style="width: 100%; font-size: 0.85rem; padding: 10px; cursor: pointer; background: #fff; border: 1px solid #ddd; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;">
            <span>Фильтр категорий</span>
            <span id="sel-count" style="font-weight: bold; color: #fa8569;"></span>
        </button>
        <div id="checkbox-list-container" class="hidden" style="position: absolute; background: white; border: 1px solid #ddd; width: 100%; z-index: 100; padding: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1);">
            <div class="checkbox-item" style="border-bottom: 1px solid #eee; padding-bottom: 8px; margin-bottom: 8px;">
                <input type="checkbox" id="all-cat" value="all"> <label for="all-cat" style="font-weight: bold;">Все</label>
            </div>
        </div>
      </div>
    </div>
    <div id="mini-recipes-grid" class="mini-recipe-grid"></div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async function () {
    const bookSlug = "{{ page.book_slug }}"; 
    const grid = document.getElementById("mini-recipes-grid");
    const checkboxContainer = document.getElementById("checkbox-list-container");

    try {
        const response = await fetch(`/api/recipes/${bookSlug}.json`);
        const allRecipes = await response.json();
        document.getElementById("recipes-count").textContent = allRecipes.length;

        const render = (list) => {
            grid.innerHTML = list.map(r => `
                <div class="mini-recipe-card">
                    <a href="${r.url}" style="text-decoration:none; color:inherit;">
                        <div class="mini-image-wrapper"><img src="${r.featured_image || r.book_cover}"></div>
                        <div class="mini-title-box"><h2 class="mini-title">${r.title}</h2></div>
                    </a>
                </div>`).join('');
        };

        const categories = [...new Set(allRecipes.flatMap(r => r.categories || []))].sort();
        categories.forEach(cat => {
            const div = document.createElement("div");
            div.className = "checkbox-item";
            div.innerHTML = `<input type="checkbox" id="c-${cat}" value="${cat}"> <label for="c-${cat}">${cat}</label>`;
            checkboxContainer.appendChild(div);
        });

        render(allRecipes);
        document.getElementById("filter-toggle").onclick = () => checkboxContainer.classList.toggle("hidden");

        checkboxContainer.onchange = (e) => {
            if (e.target.id === 'all-cat' && e.target.checked) {
                checkboxContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => { if(cb.id !== 'all-cat') cb.checked = false; });
            } else if (e.target.id !== 'all-cat') {
                document.getElementById('all-cat').checked = false;
            }
            const boxes = Array.from(checkboxContainer.querySelectorAll('input:checked')).map(b => b.value);
            const filtered = (boxes.length === 0 || boxes.includes('all')) ? allRecipes : allRecipes.filter(r => (r.categories || []).some(c => boxes.includes(c)));
            render(filtered);
            document.getElementById("sel-count").textContent = (boxes.length > 0 && !boxes.includes('all')) ? `(${boxes.length})` : '';
        };
    } catch (e) { console.error(e); }
});
</script>
