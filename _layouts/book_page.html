<script>
document.addEventListener("DOMContentLoaded", function() {
  const descriptionContainer = document.getElementById('book-description');
  const loader = document.getElementById('loader');
  const bookSlug = "{{ page.book_slug }}";
  
  if (bookSlug) {
    const targetUrl = "https://pro-culinaria.ru/tpost/" + bookSlug;
    const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(targetUrl);

    fetch(proxyUrl)
      .then(response => {
        if (response.ok) return response.json();
        throw new Error('Ошибка сети');
      })
      .then(data => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(data.contents, 'text/html');
        const contentBlock = doc.querySelector('.t-records');
        
        if (contentBlock) {
          const textElements = contentBlock.querySelectorAll('p, h2, h3, li');
          let cleanText = "";
          
          textElements.forEach(el => {
            const content = el.innerText;
            
            // Твоя стандартная фраза для игнора
            const ignorePhrase = "Оформить подписку для доступа ко всей библиотеке за 350 рублей в месяц";
            
            // Проверяем: если фразы НЕТ в тексте, то добавляем его на страницу
            if (!content.includes(ignorePhrase)) {
              cleanText += el.outerHTML; 
            }
          });

          loader.style.display = 'none';
          descriptionContainer.innerHTML = cleanText;
          
        } else {
          loader.innerText = 'Описание готовится к публикации.';
        }
      })
      .catch(err => {
        console.error(err);
        loader.innerText = 'Описание доступно на основном сайте.';
      });
  }
});
</script>
