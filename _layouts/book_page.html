---
layout: default
---

<div class="book-page-container" style="max-width: 1000px; margin: 0 auto; padding: 40px 20px; font-family: sans-serif;">
  
  <img src="{{ page.book_cover }}" alt="{{ page.book_title }}" 
       style="float: left; width: 300px; margin: 0 30px 20px 0; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);">

  <div class="book-header">
    <h1 style="margin: 0 0 10px 0; font-size: 2.2rem; color: #333;">{{ page.book_title }}</h1>
    <p style="color: #888; font-style: italic; margin-bottom: 25px; font-size: 1.1rem;">{{ page.book_author }}</p>
  </div>

  <div id="loader" style="color: #999; font-style: italic;">Загрузка описания...</div>
  <div id="book-description" style="line-height: 1.6; color: #444; font-size: 1.1rem;">
    {{ content }}
  </div>

  <div style="margin-top: 30px; clear: both;">
    <a href="{{ page.book_link }}" target="_blank" 
       style="display: inline-block; background: #fa8569; color: #fff; text-decoration: none; padding: 15px 35px; border-radius: 5px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;">
      Открыть книгу
    </a>
  </div>

  <div style="clear: both;"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const container = document.getElementById('book-description');
  const loader = document.getElementById('loader');
  const slug = "{{ page.book_slug }}";
  
  if (slug) {
    const targetUrl = "https://pro-culinaria.ru/tpost/" + slug;
    const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(targetUrl);

    fetch(proxyUrl)
      .then(res => res.ok ? res.json() : Promise.reject())
      .then(data => {
        const doc = new DOMParser().parseFromString(data.contents, 'text/html');
        // Ищем контент Тильды
        const content = doc.querySelector('.t-records') || doc.querySelector('.t603__wrapper');
        
        if (content) {
          loader.style.display = 'none';
          
          // Удаляем картинки, кнопки, формы и ту самую фразу про 350 рублей
          content.querySelectorAll('img, script, style, .t-btn, .t-form').forEach(el => el.remove());
          
          const paragraphs = content.querySelectorAll('p, li, h2, h3');
          let html = "";
          paragraphs.forEach(p => {
            if (!p.textContent.includes("350 рублей")) {
              html += p.outerHTML;
            }
          });
          
          container.innerHTML = html;
        }
      })
      .catch(() => {
        loader.innerText = 'Описание доступно по кнопке ниже.';
      });
  }
});
</script>
