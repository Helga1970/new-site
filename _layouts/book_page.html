---
layout: default
---

<div class="book-page-container" style="max-width: 1100px; margin: 0 auto; padding: 40px 20px; font-family: sans-serif;">
  
  <div style="display: flex; gap: 40px; flex-wrap: wrap;">
    
    <div style="flex: 0 0 300px; text-align: center;">
      <img id="book-cover" src="{{ page.book_cover }}" style="width: 100%; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); margin-bottom: 20px;">
      
      <a id="book-link" href="{{ page.book_link }}" target="_blank" style="display: block; background: #fa8569; color: #fff; text-decoration: none; padding: 15px; border-radius: 5px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;">
        Читать книгу
      </a>
    </div>

    <div style="flex: 1; min-width: 300px;">
      <h1 id="book-title" style="margin-top: 0; font-size: 2rem; color: #333;">{{ page.book_title }}</h1>
      <p id="book-author" style="color: #888; font-style: italic; margin-bottom: 30px;">{{ page.book_author }}</p>
      
      <div id="remote-description-container">
        <div id="loader" style="color: #999;">
          <span class="spinner"></span> Загрузка описания с основного сайта...
        </div>
        <div id="book-description" style="line-height: 1.6; color: #444; font-size: 1.1rem;"></div>
      </div>
    </div>

  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const descriptionContainer = document.getElementById('book-description');
  const loader = document.getElementById('loader');
  
  const bookSlug = "{{ page.book_slug }}";
  
  if (bookSlug) {
    const targetUrl = "https://pro-culinaria.ru/tpost/" + bookSlug;
    const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(targetUrl);

    fetch(proxyUrl)
      .then(response => {
        if (response.ok) return response.json();
        throw new Error('Network response was not ok.');
      })
      .then(data => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(data.contents, 'text/html');
        
        // Селектор для контента Тильды
        const content = doc.querySelector('.t-records');
        
        if (content) {
          loader.style.display = 'none';
          descriptionContainer.innerHTML = content.innerHTML;
          
          // Удаляем лишние элементы Тильды (кнопки, формы)
          const extraButtons = descriptionContainer.querySelectorAll('.t-btn, .t-form, script, style');
          extraButtons.forEach(btn => btn.remove());
          
        } else {
          loader.innerText = 'Описание готовится к публикации.';
        }
      })
      .catch(err => {
        console.error(err);
        loader.innerText = 'Ошибка при подключении к базе данных.';
      });
  }
});
</script>
