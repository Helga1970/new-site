<script>
document.addEventListener("DOMContentLoaded", function() {
  const descriptionContainer = document.getElementById('book-description');
  const loader = document.getElementById('loader');
  
  // Берем slug из параметров страницы. 
  // В твоем случае для "Кукис нашей мечты" slug должен быть "nmvc7b95g1-kukis-nashei-mechti"
  const bookSlug = "{{ page.book_slug }}";
  
  if (bookSlug) {
    // Формируем прямой URL к странице на Tilda
    const targetUrl = `https://pro-culinaria.ru/tpost/${bookSlug}`;

    // Используем сервис-прокси, чтобы обойти блокировку CORS (защита Tilda)
    const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(targetUrl);

    fetch(proxyUrl)
      .then(response => {
        if (response.ok) return response.json();
        throw new Error('Network response was not ok.');
      })
      .then(data => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(data.contents, 'text/html');
        
        // На Tilda основной контент статьи обычно в этих блоках
        const content = doc.querySelector('.t603') || doc.querySelector('.t-article-font') || doc.querySelector('.t-records');
        
        if (content) {
          loader.style.display = 'none';
          // Очищаем от лишних стилей Tilda, если нужно, или вставляем как есть
          descriptionContainer.innerHTML = content.innerHTML;
          
          // Маленький хак: удаляем кнопки купить или лишние ссылки, если они прилетели с того сайта
          const extraButtons = descriptionContainer.querySelectorAll('.t-btn, .t-form');
          extraButtons.forEach(btn => btn.remove());
          
        } else {
          loader.innerText = 'Описание готовится к публикации.';
        }
      })
      .catch(err => {
        console.error(err);
        loader.innerText = 'Не удалось загрузить описание напрямую. Вы можете прочитать его на основном сайте.';
      });
  }
});
</script>
