---
layout: default
---

<style>
    /* 1. ВЗЛОМ РОДИТЕЛЬСКОГО КОНТЕЙНЕРА */
    .container.main-content {
        max-width: 95vw !important;
        width: 95vw !important;
        margin: 0 auto !important;
        padding: 0 !important;
        display: block !important; /* Убираем флекс, если он мешает сетке */
    }

    section.content {
        width: 100% !important;
        max-width: 100% !important;
        margin: 0 !important;
        padding: 20px 0 !important;
    }

    /* 2. ШАПКА СТРАНИЦЫ И ФИЛЬТР */
    .page-header {
        margin-bottom: 40px;
        border-bottom: 2px solid #fa8569;
        padding-bottom: 20px;
    }

    .filter-wrapper {
        margin-top: 20px;
        position: relative;
        display: inline-block;
        min-width: 250px;
    }

    #filter-toggle {
        width: 100%;
        padding: 10px 15px;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: bold;
    }

    /* 3. ИСПРАВЛЕНИЕ ГАЛОЧЕК ФИЛЬТРА */
    .checkbox-list-container {
        position: absolute;
        top: 100%;
        left: 0;
        z-index: 1000;
        background: white;
        border: 1px solid #ddd;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        padding: 15px;
        width: 300px;
    }

    .checkbox-item {
        display: flex !important;
        align-items: center !important;
        gap: 12px !important;
        margin-bottom: 10px !important;
    }

    .checkbox-item input[type="checkbox"] {
        width: 18px !important;
        height: 18px !important;
        margin: 0 !important;
        flex-shrink: 0 !important;
        cursor: pointer;
    }

    .checkbox-item label {
        margin: 0 !important;
        cursor: pointer;
        font-size: 0.95rem !important;
    }

    /* 4. ОСНОВНАЯ СЕТКА РЕЦЕПТОВ (На всю ширину) */
    .recipes-grid {
        display: grid !important;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;
        gap: 30px !important;
        width: 100% !important;
    }

    .recipe-card {
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        transition: transform 0.3s ease;
    }

    .recipe-card:hover {
        transform: translateY(-5px);
    }

    .recipe-image-box {
        width: 100%;
        aspect-ratio: 4/3;
        overflow: hidden;
    }

    .recipe-image-box img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .recipe-info {
        padding: 20px;
        text-align: center;
    }

    .recipe-title {
        font-size: 1.1rem;
        margin: 0;
        color: #333;
        font-weight: 700;
        line-height: 1.3;
    }

    .hidden { display: none; }
</style>

<div class="page-header">
    <h1 style="font-size: 2.5rem; color: #333; margin: 0;">{{ page.title }}</h1>
    
    <div class="filter-wrapper">
        <button id="filter-toggle">
            <span>Фильтр категорий</span>
            <span id="sel-count" style="color: #fa8569; margin-left: 10px;"></span>
        </button>
        <div id="checkbox-list-container" class="checkbox-list-container hidden">
            <div class="checkbox-item" style="border-bottom: 1px solid #eee; padding-bottom: 8px; margin-bottom: 8px;">
                <input type="checkbox" id="all-cat" value="all"> <label for="all-cat" style="font-weight: bold;">Все рецепты</label>
            </div>
            </div>
    </div>
</div>

<div id="recipes-grid" class="recipes-grid">
    </div>

<script>
document.addEventListener("DOMContentLoaded", async function () {
    const bookSlug = "{{ page.book_slug }}";
    const grid = document.getElementById("recipes-grid");
    const checkboxContainer = document.getElementById("checkbox-list-container");

    try {
        const response = await fetch(`/api/recipes/${bookSlug}.json`);
        const allRecipes = await response.json();

        const render = (list) => {
            grid.innerHTML = list.map(r => `
                <div class="recipe-card">
                    <a href="${r.url}" style="text-decoration:none; color:inherit;">
                        <div class="recipe-image-box"><img src="${r.featured_image || r.book_cover}"></div>
                        <div class="recipe-info"><h2 class="recipe-title">${r.title}</h2></div>
                    </a>
                </div>`).join('');
        };

        const categories = [...new Set(allRecipes.flatMap(r => r.categories || []))].sort();
        categories.forEach(cat => {
            const div = document.createElement("div");
            div.className = "checkbox-item";
            div.innerHTML = `<input type="checkbox" id="c-${cat}" value="${cat}"> <label for="c-${cat}">${cat}</label>`;
            checkboxContainer.appendChild(div);
        });

        render(allRecipes);
        document.getElementById("filter-toggle").onclick = () => checkboxContainer.classList.toggle("hidden");

        checkboxContainer.onchange = (e) => {
            if (e.target.id === 'all-cat' && e.target.checked) {
                checkboxContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => { if(cb.id !== 'all-cat') cb.checked = false; });
            } else if (e.target.id !== 'all-cat') {
                document.getElementById('all-cat').checked = false;
            }
            const boxes = Array.from(checkboxContainer.querySelectorAll('input:checked')).map(b => b.value);
            const filtered = (boxes.length === 0 || boxes.includes('all')) ? allRecipes : allRecipes.filter(r => (r.categories || []).some(c => boxes.includes(c)));
            render(filtered);
            document.getElementById("sel-count").textContent = (boxes.length > 0 && !boxes.includes('all')) ? `(${boxes.length})` : '';
        };
    } catch (e) { console.error("Error:", e); }
});
</script>
