---
layout: default
permalink: /all-recipes-from-book/index.html
---

<style>
/* 1. ВЗЛОМ КОНТЕЙНЕРА - убираем пустоту справа */
.container.main-content, .container, .content {
    max-width: 95vw !important;
    width: 95vw !important;
    margin: 0 auto !important;
    padding: 0 !important;
}

.book-page-container { padding: 20px 0; width: 100%; }

/* 2. ЗАГОЛОВОК И УПРАВЛЕНИЕ */
.header-controls {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: flex-end;
    gap: 15px;
    margin-bottom: 30px;
    border-bottom: 2px solid #fa8569;
    padding-bottom: 20px;
}

.book-title-heading {
    font-size: 1.8em;
    font-weight: normal;
    margin: 0;
    color: #333;
}

.book-name { font-weight: bold; color: #fa8569; }

/* 3. ФИЛЬТР - ИСПРАВЛЕНИЕ ГАЛОЧЕК */
.filter-container { position: relative; width: 280px; }

.checkbox-item {
    display: flex !important;
    align-items: center !important; /* Галочка и текст в одну линию */
    gap: 10px;
    margin-bottom: 8px;
}

.checkbox-item input[type="checkbox"] {
    margin: 0 !important;
    width: 16px !important;
    height: 16px !important;
    flex-shrink: 0;
}

.checkbox-item label {
    margin: 0 !important;
    font-size: 0.9em;
    cursor: pointer;
    line-height: 1.2;
}

/* 4. СЕТКА - 5 КАРТОЧЕК В РЯД */
.recipe-grid {
    display: grid;
    /* Вычисляем ширину: 5 колонок с учетом отступов */
    grid-template-columns: repeat(5, 1fr); 
    gap: 25px;
    width: 100%;
}

/* 5. КАРТОЧКИ - ВЕРТИКАЛЬНЫЕ ПРЯМОУГОЛЬНИКИ */
.recipe-card {
    background: #fff;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    transition: transform 0.3s, box-shadow 0.3s;
    border-radius: 4px;
}

.recipe-card:hover {
    transform: translateY(-8px); /* Тот самый объем при наведении */
    box-shadow: 0 12px 20px rgba(0,0,0,0.15);
}

.recipe-image-wrapper {
    width: 100%;
    padding-top: 135%; /* Вертикальный формат (прямоугольник) */
    position: relative;
    background: #f9f9f9;
}

.recipe-image-wrapper img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.recipe-title-box {
    padding: 15px 10px;
    text-align: center;
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.recipe-title {
    font-size: 0.95em;
    margin: 0;
    color: #333;
    font-weight: 600;
    line-height: 1.3;
}

/* АДАПТИВНОСТЬ */
@media (max-width: 1400px) {
    .recipe-grid { grid-template-columns: repeat(4, 1fr); }
}
@media (max-width: 1100px) {
    .recipe-grid { grid-template-columns: repeat(3, 1fr); }
}
@media (max-width: 768px) {
    .header-controls { flex-direction: column; align-items: center; text-align: center; }
    .recipe-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
}
</style>

<div class="book-page-container">
  <div class="header-controls">
    <h1 class="book-title-heading">
      Все рецепты из книги: 
      <span id="book-name" class="book-name"></span>
      (<span id="recipes-count">0</span>)
    </h1>
    
    <div class="filter-container">
      <button class="filter-toggle" id="filter-toggle">
        <span class="button-text">Фильтр по категории</span>
        <span class="selected-count"></span>
      </button>
      <div class="checkbox-list-container hidden" id="checkbox-list-container">
        <div class="checkbox-item all-option">
          <input type="checkbox" id="all-categories" value="all">
          <label for="all-categories">Все</label>
        </div>
      </div>
    </div>
  </div>

  <div id="recipes-grid" class="recipe-grid"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async function () {
    const pathParts = window.location.pathname.split("/").filter(Boolean);
    const bookSlug = pathParts[pathParts.length - 1];
    const jsonUrl = `/api/recipes/${bookSlug}.json`;

    const grid = document.getElementById("recipes-grid");
    const filterToggle = document.getElementById("filter-toggle");
    const checkboxContainer = document.getElementById("checkbox-list-container");
    const selectedCountSpan = document.querySelector('.selected-count');
    const allCategoriesCheckbox = document.getElementById('all-categories');
    let allRecipes = [];
    let categoryCounts = {};

    const updateSelectedCount = () => {
        const checkedBoxes = Array.from(checkboxContainer.querySelectorAll('input[type="checkbox"]:checked')).filter(cb => cb.value !== 'all');
        selectedCountSpan.textContent = checkedBoxes.length > 0 ? `(${checkedBoxes.length})` : '';
    };

    const renderRecipes = (recipesToRender) => {
        grid.innerHTML = recipesToRender.length > 0 
            ? recipesToRender.map(recipe => `
                <div class="recipe-card">
                    <a href="${recipe.url}">
                        <div class="recipe-image-wrapper">
                            <img src="${recipe.featured_image || recipe.book_cover}" alt="${recipe.title}">
                        </div>
                        <div class="recipe-title-box">
                            <h2 class="recipe-title">${recipe.title}</h2>
                        </div>
                    </a>
                </div>`).join('')
            : "<p>Рецепты не найдены.</p>";
    };

    try {
        const response = await fetch(jsonUrl);
        allRecipes = await response.json();
        
        document.getElementById("book-name").textContent = allRecipes[0].book_title;
        document.getElementById("recipes-count").textContent = allRecipes.length;

        categoryCounts = allRecipes.reduce((counts, recipe) => {
            (recipe.categories || []).forEach(cat => counts[cat] = (counts[cat] || 0) + 1);
            return counts;
        }, {});

        const categories = [...new Set(allRecipes.flatMap(r => r.categories || []))].sort();
        categories.forEach(category => {
            const itemDiv = document.createElement("div");
            itemDiv.className = "checkbox-item";
            itemDiv.innerHTML = `
                <input type="checkbox" id="cat-${category}" value="${category}">
                <label for="cat-${category}">${category}</label>
            `;
            checkboxContainer.appendChild(itemDiv);
        });

        renderRecipes(allRecipes);

        filterToggle.onclick = () => checkboxContainer.classList.toggle("hidden");
        document.onclick = (e) => { if (!filterToggle.contains(e.target) && !checkboxContainer.contains(e.target)) checkboxContainer.classList.add("hidden"); };

        checkboxContainer.onchange = (e) => {
            if (e.target.id === 'all-categories') {
                checkboxContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                    if (cb !== allCategoriesCheckbox) { cb.checked = false; cb.nextElementSibling.textContent = cb.value; }
                });
            } else {
                allCategoriesCheckbox.checked = false;
                const label = e.target.nextElementSibling;
                label.textContent = e.target.checked ? `${e.target.value} (${categoryCounts[e.target.value] || 0})` : e.target.value;
            }
            updateSelectedCount();
            const checkedBoxes = Array.from(checkboxContainer.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
            const filtered = (checkedBoxes.length === 0 || checkedBoxes.includes('all')) ? allRecipes : allRecipes.filter(r => (r.categories || []).some(cat => checkedBoxes.includes(cat)));
            renderRecipes(filtered);
        };
    } catch (e) { console.error(e); }
});
</script>
