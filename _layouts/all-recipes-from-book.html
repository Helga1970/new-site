---
layout: default
---

<div class="book-page-wrapper" style="max-width: 1200px; margin: 0 auto; padding: 40px 20px; display: flex; gap: 40px; font-family: sans-serif;">
  
  <div class="book-main-content" style="flex: 2;">
    <img src="{{ page.book_cover }}" alt="{{ page.book_title }}" 
         style="float: left; width: 280px; margin: 0 25px 20px 0; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">

    <h1 style="margin: 0 0 10px 0; font-size: 2.2rem; color: #333;">{{ page.book_title }}</h1>
    <p style="color: #888; font-style: italic; margin-bottom: 25px;">{{ page.book_author }}</p>
      
    <div class="book-description" style="line-height: 1.6; color: #444; font-size: 1.1rem; text-align: justify;">
      {{ content }}
    </div>

    <div style="margin-top: 30px; clear: both;">
      <a href="{{ page.book_link }}" target="_blank" 
         style="display: inline-block; background: #fa8569; color: #fff; text-decoration: none; padding: 15px 35px; border-radius: 5px; font-weight: bold; text-transform: uppercase;">
        Открыть книгу
      </a>
    </div>
  </div>

  <div class="book-sidebar" style="flex: 1; border-left: 1px solid #eee; padding-left: 30px; min-width: 300px;">
    <h3 style="margin-top: 0; font-size: 1.4rem; color: #333; border-bottom: 2px solid #fa8569; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
      Рецепты из книги
      <span id="js-recipes-count" style="background: #fa8569; color: #fff; font-size: 0.9rem; padding: 2px 10px; border-radius: 20px; display: none;">0</span>
    </h3>
    
    <div id="js-sidebar-recipes" style="margin-top: 20px;">
      <p style="color: #999; font-style: italic;">Загрузка...</p>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async function () {
    const bookSlug = "{{ page.book_slug }}"; // Берем слаг прямо из Jekyll
    const jsonUrl = `/api/recipes/${bookSlug}.json`;
    const sidebarGrid = document.getElementById("js-sidebar-recipes");
    const countBadge = document.getElementById("js-recipes-count");

    try {
        const response = await fetch(jsonUrl);
        if (!response.ok) throw new Error('JSON не найден');
        
        const recipes = await response.json();
        
        if (recipes.length > 0) {
            countBadge.textContent = recipes.length;
            countBadge.style.display = 'inline-block';
            sidebarGrid.innerHTML = ""; // Очищаем "Загрузку"

            recipes.forEach(recipe => {
                const recipeImg = recipe.featured_image || recipe.book_cover;
                const item = document.createElement("a");
                item.href = recipe.url;
                item.className = "sidebar-recipe-item";
                item.style = "display: flex; align-items: center; text-decoration: none; color: #333; margin-bottom: 15px; transition: 0.2s;";
                item.innerHTML = `
                    <img src="${recipeImg}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 6px; margin-right: 15px;">
                    <span style="font-size: 0.95rem; font-weight: 500; line-height: 1.3;">${recipe.title}</span>
                `;
                sidebarGrid.appendChild(item);
            });
        } else {
            sidebarGrid.innerHTML = "<p style='color: #999; font-style: italic;'>Рецептов пока нет.</p>";
        }
    } catch (e) {
        console.error("Ошибка сайдбара:", e);
        sidebarGrid.innerHTML = ""; // Если файла нет, просто скрываем блок
    }
});
</script>

<style>
  .sidebar-recipe-item:hover { opacity: 0.7; transform: translateX(5px); }
  @media (max-width: 900px) {
    .book-page-wrapper { flex-direction: column; }
    .book-sidebar { border-left: none; padding-left: 0; border-top: 1px solid #eee; padding-top: 30px; }
  }
</style>
