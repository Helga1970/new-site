<!DOCTYPE html>
<html lang="en">

{% include head.html %}

<body>
  {% include header.html %}

  <div class="container-fluid">

  <!-- Верхняя секция с фоном и поиском -->
<section class="hero-section">
  <div class="hero-overlay">
    <div class="container d-flex justify-content-center align-items-center" style="height:500px;">
      <div class="hero-search w-100" style="max-width:900px;">
        <form action="/search" method="get" class="d-flex w-100">
          <input type="text" name="q" 
                 placeholder="Найти рецепт, ингредиент, вид или стиль блюда, технику приготовления..." 
                 class="form-control border-0 flex-grow-1" 
                 style="border-radius:0; padding:15px; font-size:18px;">
          <button type="submit" class="btn" 
                  style="border-radius:0; padding:0 25px; font-size:18px; 
                         background: linear-gradient(0turn, rgba(255,106,40,1) 0%, rgba(254,47,87,1) 100%); 
                         color:#fff; border:none;">
            Найти
          </button>
        </form>
      </div>
    </div>
  </div>
</section>

  <section class="section">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="row masonry-container pt-5">
            <!-- Карточки будут подгружаться сюда через JS -->
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<script src="{{ site.baseurl }}/assets/plugins/jQuery/jquery.min.js"></script>
<script src="{{ site.baseurl }}/assets/plugins/bootstrap/bootstrap.min.js"></script>
<script src="{{ site.baseurl }}/assets/plugins/slick/slick.min.js"></script>
<script src="{{ site.baseurl }}/assets/plugins/imagesloaded/imagesloaded.pkgd.js"></script>
<script src="{{ site.baseurl }}/assets/plugins/masonry/masonry.js"></script>
<script src="{{ site.baseurl }}/assets/plugins/smooth-scroll/smooth-scroll.js"></script>
<script src="{{ site.baseurl }}/assets/js/script.js"></script>

<!-- Динамическая подгрузка карточек -->
<script>
let recipes = [];
let index = 0;
const perPage = 12;

async function loadRecipes() {
    const response = await fetch('/assets/data/recipes.json');
    const data = await response.json();

    // оставляем только рецепты с картинкой
    recipes = data.filter(r => r.featured_image);

    // перемешиваем массив
    recipes = recipes.sort(() => Math.random() - 0.5);

    // выводим первые карточки
    appendRecipes();
}

function appendRecipes() {
    const container = document.querySelector('.masonry-container');
    const slice = recipes.slice(index, index + perPage);

    slice.forEach(post => {
        const card = document.createElement('div');
        card.className = 'col-lg-3 col-sm-6 mb-5 masonry-item';
        card.innerHTML = `
            <div class="card p-0 border-0 rounded-0 hover-shadow">
                <a href="${post.url}">
                    <img class="img-fluid rounded-top rounded-0" src="${post.featured_image}" alt="feature-image">
                    <div class="card-body" style="position: relative;">
                        <ul class="list-inline mb-3">
                            ${post.catalogue.map(c => `<li class="list-inline-item mr-3 text-uppercase font-primary font-extra-small" style="font-size: 0.8rem;">
                                <a href="/catalogue/${c.toLowerCase().replace(/\s+/g,'-')}">${c}</a>
                            </li>`).join('')}
                        </ul>
                        <p class="font-secondary mb-3 mt-1 font-extra-small">
                            Рецепт из книги: <span class="book-title"><a href="${post.book.link}" style="color: #fa8569; font-weight: bold;">${post.book.title}</a></span>
                        </p>
                        <h4 class="mb-3">${post.title}</h4>
                        <p class="font-secondary mb-4">${post.content}</p>
                        <a href="${post.url}" class="text-uppercase font-primary font-extra-small" style="color: #fa8569; font-weight: bold; text-align: center; display: block;">
                            Открыть рецепт
                        </a>
                    </div>
                </a>
            </div>
        `;
        container.appendChild(card);
    });

    index += perPage;

    // обновляем Masonry после добавления новых карточек
    if (typeof Masonry !== 'undefined') {
        imagesLoaded(container, function() {
            new Masonry(container, {
                itemSelector: '.masonry-item',
                percentPosition: true,
                gutter: 30
            });
        });
    }
}

// infinite scroll
window.addEventListener('scroll', () => {
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
        appendRecipes();
    }
});

// запуск при загрузке страницы
loadRecipes();
</script>

</body>
</html>
