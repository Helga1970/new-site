{% comment %} Start of the updated code for related recipes {% endcomment %}
{% assign current_tags = page.tags %}
{% assign related_recipes = site.recipes | where_exp: 'item', "item.url != page.url" %}
{% assign found_related = false %}

{% if current_tags.size > 0 %}
    {% for recipe in related_recipes %}
        {% assign common_tags = recipe.tags | intersection: current_tags %}
        {% if common_tags.size > 0 %}
            {% assign found_related = true %}
        {% endif %}
    {% endfor %}
{% endif %}

{% if found_related %}
  <div class="related-section">
    <h2>Похожие рецепты</h2>
    <div class="related-items-grid">
        {% for recipe in related_recipes %}
            {% assign common_tags = recipe.tags | intersection: current_tags %}
            {% if common_tags.size > 0 %}
                <div class="related-item">
                    {% if recipe.featured_image %}
                        <div class="related-item-image" style="background-image: url('{{ recipe.featured_image }}');"></div>
                    {% endif %}
                    <div class="related-item-content">
                        <p class="related-item-title">{{ recipe.title }}</p>
                        {% if recipe.book %}
                            <p class="related-item-book">Из книги: "{{ recipe.book.title }}"</p>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
  </div>
{% endif %}
{% comment %} End of the updated code for related recipes {% endcomment %}
