---
layout: default
---
<article class="post">
	{% include post-heading.html post=page post_page=true %}

{% if page.book %}
  <div class="book-block mobile-only">
    <img class="book-cover" src="{{ page.book.cover }}" alt="{{ page.book.title }}">
    <div class="book-meta">
      <h3>{{ page.book.title }}</h3>
      <p>{{ page.book.author }}</p>
    </div>
  </div>
  <div class="book-more-recipes mobile-only" style="background-color:#fa8569; color:#fff; font-weight:bold; border-radius:0; justify-content:center; align-items:center; padding:10px 0; width:100%;">
    Ещё рецепты из книги
  </div>
{% endif %}
	
<div class="recipe-wrapper">
	<div class="recipe-body">
		{{ content }}
	</div>
	
	<div class="image">
		<img src="{{ page.featured_image }}" alt="{{ page.title }}">
	</div>
</div>

	<ul id="recipe" class="recipe-overview">
  {% if page.recipe.servings %}
    <li title="Servings">{% include recipe-icon.html icon="quantity" %}<span>{{ page.recipe.servings }}</span></li>
  {% endif %}

  {% if page.recipe.prep %}
    <li title="Prep Time">{% include recipe-icon.html icon="time" %}<span>{{ page.recipe.prep }}</span></li>
  {% endif %}

  {% if page.recipe.cook %}
    <li title="Cook Time">{% include recipe-icon.html icon="cook" %}<span>{{ page.recipe.cook }}</span></li>
  {% endif %}

  {% if page.recipe.difficulty %}
  <li title="Difficulty">
    {% include recipe-icon.html icon="difficulty" %}
    <span class="star">
      {{ page.recipe.difficulty | replace: "*", "★" }}
    </span>
  </li>
{% endif %}
</ul>

	<div class="recipe-contents">
	<div class="ingredients">
		<h3 class="recipe-heading">Ингредиенты:</h3>
		{{ page.recipe.ingredients_markdown | markdownify }}
	</div>

	<div class="directions">
		<h3 class="recipe-heading">Приготовление:</h3>
		{{ page.recipe.directions_markdown | markdownify }}
	</div>
</div>

{% comment %} Код для похожих рецептов {% endcomment %}
{% assign current_tags = page.tags | default: empty %}
{% assign all_recipes = site.recipes %}
{% assign related_recipes = "" | split: "" %}

{% for recipe in all_recipes %}
  {% if recipe.url != page.url and recipe.tags %}
    {% assign common_tags = recipe.tags | intersection: current_tags %}
    {% if common_tags.size > 0 %}
      {% assign related_recipes = related_recipes | push: recipe %}
    {% endif %}
  {% endif %}
{% endfor %}

{% if related_recipes.size > 0 %}
  <div class="related-recipes-section">
    <h3>Похожие рецепты ({{ related_recipes | size }})</h3>
    <div id="related-list" class="related-recipes-grid" data-recipes='{{ related_recipes | jsonify }}'>
      {% for recipe in related_recipes | slice: 0, 4 %}
        <div class="recipe-card-list-item hidden" data-index="{{ forloop.index0 }}">
          <a href="{{ recipe.url | relative_url }}">
            {% if recipe.featured_image %}
              <div class="recipe-card-image-wrapper">
                <img class="recipe-card-image" src="{{ recipe.featured_image }}" alt="{{ recipe.title }}">
              </div>
            {% endif %}
            <div class="recipe-card-content-list-item">
              <p class="recipe-title" style="font-size: 0.9em; margin: 0; font-weight: bold;">{{ recipe.title }}</p>
              {% if recipe.book.title %}
                <p class="recipe-book" style="font-size: 0.9em; margin-top: 2px;">Из книги {{ recipe.book.title }}</p>
              {% endif %}
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
    <button id="show-more" style="background-color:#fa8569; color:#fff; font-weight:bold; border-radius:0; padding:8px 16px; font-size:1em; margin-top:12px; display:inline-block; border:none; cursor:pointer;">
      Показать ещё
    </button>
  </div>
{% endif %}
{% comment %} Конец кода для похожих рецептов {% endcomment %}

	{% if site.disqus_shortname and page.comments %}
		<div id="disqus_thread"></div>
		<script>
			var disqus_shortname = '{{ site.disqus_shortname }}';
			var disqus_config = function () {
				this.page.url = "{{ page.url | prepend: site.url }}";
				this.page.identifier = "{{ page.id }}";
			};
			(function() {
				var d = document, s = d.createElement('script');
				s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				s.setAttribute('data-timestamp', +new Date());
				(d.head || d.body).appendChild(s);
			})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
	{% endif %}
</article>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script type="text/javascript" src="{{ site.baseurl }}/js/jquery.imgPin.min.js"></script>
<script>
	$(function() {
		$('.post img').imgPin();

		$('a[href*=\\#]').on('click', function(event){
			var el = $(this.hash);
			if (el.length > 0) {
				event.preventDefault();
				$('html,body').animate({scrollTop:$(this.hash).offset().top - 50}, 500);
			}
		});
	});
</script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const items = [...document.querySelectorAll("#related-list .recipe-card-list-item")];
    const btn = document.getElementById("show-more");
    const recipesData = JSON.parse(document.querySelector("#related-list").dataset.recipes);

    // Сортировка рецептов по количеству общих тегов (нужно вычислить вручную, если теги не переданы)
    const currentTags = {{ page.tags | jsonify | default: '[]' }};
    const sortedRecipes = recipesData.sort((a, b) => {
      const commonA = (a.tags || []).filter(tag => currentTags.includes(tag)).length;
      const commonB = (b.tags || []).filter(tag => currentTags.includes(tag)).length;
      return commonB - commonA; // По убыванию
    });

    // Обновление элементов в DOM с сортировкой
    items.forEach((item, index) => {
      const recipe = sortedRecipes[index];
      if (recipe) {
        item.querySelector("a").href = recipe.url;
        item.querySelector(".recipe-title").textContent = recipe.title;
        const book = item.querySelector(".recipe-book");
        if (book) book.textContent = recipe.book ? `Из книги ${recipe.book.title}` : "";
        const img = item.querySelector(".recipe-card-image");
        if (img) img.src = recipe.featured_image || "";
      }
    });

    let visible = 0;
    const firstStep = 4;
    const nextStep = 20;

    function showNext() {
      const step = (visible === 0) ? firstStep : nextStep;
      for (let i = visible; i < visible + step && i < items.length; i++) {
        items[i].classList.remove("hidden");
      }
      visible += step;
      if (visible >= items.length) {
        btn.style.display = "none";
      }
    }

    showNext();
    if (btn && items.length > firstStep) btn.addEventListener("click", showNext);
  });
</script>
<style>
  .hidden { display: none; }
</style>
