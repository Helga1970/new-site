{% comment %} Код для похожих рецептов {% endcomment %}
{% assign current_tags = page.tags %}
{% assign all_recipes = site.recipes %}
{% assign related_recipes = "" | split: "" %}

{% for recipe in all_recipes %}
  {% if recipe.url != page.url %}
    {% for tag in recipe.tags %}
      {% if current_tags contains tag %}
        {% assign related_recipes = related_recipes | push: recipe %}
        {% break %}
      {% endif %}
    {% endfor %}
  {% endif %}
{% endfor %}

{% assign unique_related_recipes = related_recipes | uniq %}
{% assign shuffled_recipes = unique_related_recipes | shuffle | slice: 0, 4 %}

{% if shuffled_recipes.size > 0 %}
  <div class="related-recipes-section">
    <h3>Похожие рецепты</h3>
    <div class="related-recipes-grid">
      {% for recipe in shuffled_recipes %}
        <div class="recipe-card">
          <a href="{{ recipe.url | relative_url }}">
            {% if recipe.featured_image %}
              <img class="recipe-card-image" src="{{ recipe.featured_image }}" alt="{{ recipe.title }}">
            {% endif %}
            <div class="recipe-card-content">
              <h4>{{ recipe.title }}</h4>
              <p>{{ recipe.excerpt | truncatewords: 20 }}</p>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  </div>
{% endif %}
{% comment %} Конец кода для похожих рецептов {% endcomment %}
